<section id="home" class="relative min-h-screen w-full bg-cover bg-center bg-no-repeat"
  style="background-image:url('/images/hero_bg.jpg');">

  <div class="relative max-w-7xl mx-auto grid md:grid-cols-2 gap-12 p-8 md:p-12 z-20">

    <!-- PANEL BLANCO -->
    <div class="bg-white/65 backdrop-blur-sm p-8 sm:p-12 rounded-xl shadow-2xl relative z-40">

      <p class="font-title text-sm tracking-widest text-fox-red mb-3">
        DAR3D – {{ T "hero_subtitle" }}
      </p>

      <h1 class="text-5xl sm:text-7xl font-title font-bold leading-tight text-deep-black">
        {{ if eq .Language.Lang "es" }}Criaturas<br>de Otra<br>Línea Temporal{{ else }}Creatures<br>From
        Another<br>Timeline{{ end }}
      </h1>

      <p class="mt-6 text-lg text-ui-dark-gray">
        {{ T "hero_subtitle_long" | default (T "hero_subtitle") }}
      </p>

      <div class="mt-10 flex flex-col sm:flex-row gap-4">
        <a href="{{ "/#creatures" | relLangURL }}"
          class="wireframe-border text-center px-8 py-3 bg-fox-red text-grey rounded-lg shadow-lg hover:bg-fox-red/90">
          {{ T "hero_button_explore" }}
        </a>

        <a href="{{ "/products/" | relLangURL }}"
          class="text-center px-8 py-3 bg-deep-black text-neon-green border border-neon-green/50 rounded-lg">
          {{ T "hero_button_store" }}
        </a>
      </div>
    </div>

    <!-- HERO VISUAL DERECHO -->
    <div class="relative w-full h-[480px] md:h-[700px]
                rounded-xl overflow-hidden shadow-xl">

      <!-- IMAGEN PLACEHOLDER -->
      <img id="hero-placeholder" src="/images/hero.png" class="absolute inset-0 h-full object-cover z-10
                  transition-opacity duration-700">

      <!-- VISOR 3D (DOUBLE BUFFER) -->
      <div id="hero-3d-wrapper" class="absolute inset-0 z-20 pointer-events-auto">
        <div id="hero-viewer-1" class="absolute inset-0 opacity-0 transition-opacity duration-1000"></div>
        <div id="hero-viewer-2" class="absolute inset-0 opacity-0 transition-opacity duration-1000"></div>
      </div>

    </div>

  </div>

</section>
<script type="module">

  document.addEventListener("DOMContentLoaded", () => {

    const MODELS = [
      { name: "{{ T "hero_model_sewer" | default "Sewer Monster" }}", glb: "sewer_monster.glb" },
      { name: "{{ T "hero_model_alien" | default "Grey Alien" }}", glb: "alien-d1.glb" },
      { name: "{{ T "hero_model_synth" | default "Dark Synth" }}", glb: "dron-militar-a1.glb" },
      { name: "{{ T "hero_model_david" | default "Mutant David" }}", glb: "david-mutante-a1.glb" },
      { name: "{{ T "hero_model_sintetica" | default "Dissident Synthetic" }}", glb: "sintetica-pistola2.glb" },
      { name: "{{ T "hero_model_scolopendra" | default "Giant Scolopendra" }}" , glb: "scolopendrae_gigantae.glb" }
    ];

    const IPFS_BASE = "https://w3s.link/ipfs/bafybeia72hosqwsvmoj3knqp3ihe5dmuiwbayhyrvalsd3gv4ktmoit7oa/";

    const v1 = document.getElementById("hero-viewer-1");
    const v2 = document.getElementById("hero-viewer-2");
    const placeholder = document.getElementById("hero-placeholder");

    let activeViewer = 1; // 1 or 2
    let index = 0;

    function createViewerContent(container, model) {
      container.innerHTML = "";
      const mv = document.createElement("model-viewer");
      mv.src = IPFS_BASE + model.glb;
      mv.style.width = "100%";
      mv.style.height = "100%";
      mv.setAttribute("auto-rotate", "");
      mv.setAttribute("camera-controls", "");
      mv.setAttribute("interaction-prompt", "none");
      mv.setAttribute("shadow-intensity", "1");
      // Ensure smooth loading
      mv.setAttribute("reveal", "auto");

      container.appendChild(mv);
      return mv;
    }

    function loadNextModel(i) {
      const model = MODELS[i];
      if (!model) return;

      // Determine target container (if active is 1, target is 2)
      const targetContainer = activeViewer === 1 ? v2 : v1;
      const currentContainer = activeViewer === 1 ? v1 : v2;

      darEvent("hero_preload_model", { model: model.name });

      const mv = createViewerContent(targetContainer, model);

      mv.addEventListener("load", () => {
        // 1. Fade IN target
        targetContainer.classList.remove("opacity-0");
        targetContainer.classList.add("opacity-100");

        // 2. Fade OUT current
        currentContainer.classList.remove("opacity-100");
        currentContainer.classList.add("opacity-0");

        // 3. Fade OUT placeholder (only first time)
        if (!placeholder.classList.contains("opacity-0")) {
          placeholder.classList.add("opacity-0");
        }

        // Cleanup old container after transition (1s) to save resources
        setTimeout(() => {
          currentContainer.innerHTML = "";
        }, 1000);

        // Swap active index
        activeViewer = activeViewer === 1 ? 2 : 1;

        darEvent("hero_model_visible", { model: model.name });
      }, { once: true });

      let interactionFired = false;
      mv.addEventListener("camera-change", () => {
        if (!interactionFired) {
          interactionFired = true;
          darEvent("interact_3d_model", { model: model.name, source: "hero" });
        }
      });
    }

    // Start loop
    setTimeout(() => loadNextModel(index), 3500);

    setInterval(() => {
      index = (index + 1) % MODELS.length;
      loadNextModel(index);
    }, 9000);

  });
</script>