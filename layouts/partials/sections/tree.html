<section id="criaturaTree" class="max-w-6xl mx-auto px-4 py-10 text-fox-red">
    <h1 class="text-4xl font-title text-center mb-12">{{ T "arbol_criaturas" }}</h1>

    <div id="nivel1" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 text-center"></div>

    <div id="nivelesContainer"></div>
</section>

<div class="flex justify-center mb-12">
    <a href="{{ "/" | relLangURL }}">
        <img src="/images/dar3D-logo.jpg" class="w-64 rounded-xl border border-fox-red" />
    </a>
</div>

<!-- 1) Definir CRIATURAS ANTES del JS principal -->
{{- $d := .Site.Data.criaturas -}}
{{- $r := dict -}}
{{- range $c, $s := $d -}}
{{- $translatedCat := T (printf "cat_%s" $c) | default $c -}}
{{- $sm := dict -}}
{{- range $sk, $is := $s -}}
{{- $im := dict -}}
{{- range $k, $i := $is -}}
{{- $itemName := T $k | default $k -}}
{{- $itemSlug := $k | urlize -}}
{{- $pagePath := printf "/criaturas/%s" $itemSlug -}}
{{- $page := site.GetPage $pagePath -}}
{{- $actualUrl := "" -}}
{{- if $page -}}
{{- $actualUrl = $page.RelPermalink -}}
{{- else -}}
{{- /* Fallback por si no existe la página yet: intentamos construirla standar */ -}}
{{- $actualUrl = printf "/criaturas/%s/" $itemSlug -}}
{{- end -}}

{{- $im = merge $im (dict $itemName (dict "nombre" $itemName "slug" $itemSlug "wiki_url" $actualUrl "desc" (T $i.desc |
default $i.desc)
"img" $i.img "glb_name" $i.glb_name "glb" (printf "%s%s/%s" $.Site.Params.ipfsBase $.Site.Params.glb_cid $i.glb_name)
"glb_url" (printf "%s%s/%s" $.Site.Params.ipfsBase $.Site.Params.glb_cid $i.glb_name) "tipo" (T $i.tipo | default
$i.tipo))) -}}
{{- end -}}
{{- $sm = merge $sm (dict $sk $im) -}}
{{- end -}}
{{- $r = merge $r (dict $translatedCat $sm) -}}
{{- end -}}
<script>
    window.CRIATURAS = {{ $r | jsonify | safeJS }};
</script>

<!-- 2) Cargar model-viewer -->
<script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer@3.3.0/dist/model-viewer.min.js">
</script>

<!-- 3) Cargar la lógica del árbol -->
<script src="/js/arbol-criaturas-v2.js" defer></script>