<div class="w-full flex justify-center my-6">
    <div class="relative w-full max-w-xl group">

        <!-- LEYENDA TÃCTICA SUPERIOR -->
        <div
            class="absolute -top-3 left-4 px-2 bg-deep-black text-[9px] font-mono text-cyan-400 uppercase tracking-widest border-x border-cyan-400/30 z-20">
            Scanning_Module // v3.042
        </div>

        <input id="search-input" type="text" placeholder="{{ T "search_placeholder" }}" class="w-full px-5 py-3 rounded-lg border border-cyan-400/20
                      focus:outline-none focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400/50
                      bg-ui-dark-gray/80 backdrop-blur-md shadow-2xl text-bone-white placeholder-bone-white/60 
                      font-mono text-sm transition-all duration-300" />

        <!-- RESULTADOS DROPDOWN -->
        <div id="search-results"
            class="absolute w-full bg-ui-dark-gray/95 backdrop-blur-xl border border-cyan-400/20 rounded-lg mt-2 shadow-[0_20px_50px_rgba(0,0,0,0.8)] hidden z-50 overflow-hidden"
            data-no-results="{{ T " search_no_results" }}">
        </div>

    </div>
</div>

<style>
    #search-results::-webkit-scrollbar {
        width: 4px;
    }

    #search-results::-webkit-scrollbar-track {
        background: transparent;
    }

    #search-results::-webkit-scrollbar-thumb {
        background: rgba(34, 211, 238, 0.2);
        border-radius: 10px;
    }

    .search-item {
        transition: all 0.2s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }

    .search-item:hover {
        background: rgba(92, 255, 191, 0.05);
        border-left: 3px solid #5CFFBF;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const input = document.getElementById("search-input");
        const resultsBox = document.getElementById("search-results");

        input.addEventListener("input", () => {
            const query = input.value.toLowerCase().trim();

            if (!query) {
                resultsBox.classList.add("hidden");
                resultsBox.innerHTML = "";
                return;
            }

            const matches = [];

            // window.CRIATURAS_3042 es inyectado desde nav.html
            if (window.CRIATURAS_3042) {
                for (const cat in window.CRIATURAS_3042) {
                    for (const sub in window.CRIATURAS_3042[cat]) {
                        for (const item of window.CRIATURAS_3042[cat][sub]) {
                            if (
                                item.nombre.toLowerCase().includes(query) ||
                                (item.desc && item.desc.toLowerCase().includes(query)) ||
                                (item.tipo && item.tipo.toLowerCase().includes(query))
                            ) {
                                matches.push(item);
                            }
                        }
                    }
                }
            }

            renderResults(matches);
        });

        function renderResults(list) {
            if (!list.length) {
                resultsBox.classList.remove("hidden");
                const noResultsText = resultsBox.getAttribute("data-no-results") || "NODE_NOT_FOUND";
                resultsBox.innerHTML = `<div class='p-4 text-xs font-mono text-fox-red/60 uppercase tracking-tighter italic'>[ERROR] ${noResultsText}</div>`;
                return;
            }

            const html = list.map(item => `
            <a href="${window.LANG_PREFIX}criaturas/${item.slug}/" class="search-item flex items-center p-3 text-none">
                <div class="relative w-12 h-12 mr-4 border border-cyan-400/10 rounded overflow-hidden p-1 bg-deep-black/30">
                    <img src="${item.img}" class="w-full h-full object-contain opacity-80 group-hover:opacity-100 transition-opacity" />
                </div>
                <div class="flex flex-col">
                    <span class="text-bone-white font-title text-xs tracking-wider uppercase">${item.nombre}</span>
                    <span class="text-[9px] text-neon-green/60 font-mono mt-1">${item.tipo}</span>
                </div>
            </a>
        `).join("");

            resultsBox.innerHTML = html;
            resultsBox.classList.remove("hidden");
        }

        // Close when clicking outside
        document.addEventListener("click", (e) => {
            if (!input.contains(e.target) && !resultsBox.contains(e.target)) {
                resultsBox.classList.add("hidden");
            }
        });
    });
</script>