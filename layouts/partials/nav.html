<header class="sticky top-0 z-50 bg-ui-dark-gray/90 backdrop-blur-sm shadow-xl border-b border-fox-red/30">
    <div id="fox-mini-3d" class="fixed top-4 left-4 w-[80px] h-[80px] z-[999] pointer-events-none"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        <div class="flex items-center space-x-3">
            <div class="w-[60px] h-[60px] flex items-center justify-center pointer-events-none">
                {{ partial "glb_viewer_logo.html" (dict "src"
                "https://w3s.link/ipfs/bafybeia72hosqwsvmoj3knqp3ihe5dmuiwbayhyrvalsd3gv4ktmoit7oa/fox.glb" "height"
                "48px") }}
            </div>
            <a href="{{ "/" | relLangURL }}"
                class="text-3xl font-title text-bone-white tracking-widest hover:text-fox-red transition duration-300">
                <span class="logo-text">DAR3D</span>
            </a>
        </div>

        <!-- NAV DESKTOP -->
        <nav class="hidden md:flex flex-wrap items-center space-x-6 font-title text-sm tracking-wide">
            <a href="{{ "/#creatures" | relLangURL }}" class="hover:text-neon-green">{{ T "criaturas" }}</a>
            <a href="{{ "/#gadgets" | relLangURL }}" class="hover:text-neon-green">{{ T "gadgets" }}</a>
            <a href="{{ "/#fanart" | relLangURL }}" class="hover:text-neon-green">{{ T "fanart" }}</a>
            <a href="{{ "/lore/" | relLangURL }}" class="hover:text-neon-green">{{ T "wiki" }}</a>

            <a href="{{ "/products/" | relLangURL }}"
                class="px-4 py-1.5 text-ui-dark-gray bg-fox-red font-bold rounded-lg hover:bg-bone-white transition duration-200 shadow-md">
                {{ T "tienda" }}
            </a>

            <!--  IDIOMAS -->
            <div class="flex items-center space-x-3 border-l border-fox-red/30 pl-4 ml-2">
                {{ range .AllTranslations }}
                <a href="{{ .RelPermalink }}" class="flex items-center space-x-1 group">
                    <span
                        class="uppercase text-xs font-bold transition {{ if eq .Language.Lang $.Lang }}text-fox-red{{ else }}text-bone-white/40 group-hover:text-bone-white{{ end }}">
                        {{ .Language.Lang }}
                    </span>
                    <span class="text-lg opacity-80 group-hover:opacity-100 transition">
                        {{ if eq .Language.Lang "es" }}{{ else }}{{ end }}
                    </span>
                    {{ end }}
            </div>

            <!-- THEME TOGGLE -->
            <button onclick="window.toggleTheme()"
                class="ml-4 p-2 rounded-full hover:bg-white/5 transition-colors group relative"
                aria-label="Toggle Theme">
                <!-- Sun Icon (Show in Dark) -->
                <svg class="w-5 h-5 text-bone-white group-hover:text-fox-red transition-colors"
                    style="display: var(--theme-sun-display, block);" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
                <!-- Moon Icon (Show in Light) -->
                <svg class="w-5 h-5 text-bone-white group-hover:text-fox-red transition-colors"
                    style="display: var(--theme-moon-display, none);" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                    </path>
                </svg>
            </button>

            <div class="flex items-center space-x-2">
                {{- $d := .Site.Data.criaturas -}}
                {{- $r := dict -}}
                {{- range $c, $s := $d -}}
                {{- $sm := dict -}}
                {{- range $sk, $is := $s -}}
                {{- $il := slice -}}
                {{- range $k, $i := $is -}}
                {{- $il = $il | append (dict "nombre" (T $k | default $k) "slug" ($k | urlize) "desc" (T $i.desc |
                default $i.desc) "img" $i.img "glb_name" $i.glb_name "glb_url" (printf "%s%s/%s" $.Site.Params.ipfsBase
                $.Site.Params.glb_cid $i.glb_name) "tipo" (T $i.tipo | default $i.tipo)) -}}
                {{- end -}}
                {{- $sm = merge $sm (dict $sk $il) -}}
                {{- end -}}
                {{- $r = merge $r (dict $c $sm) -}}
                {{- end -}}
                <script>
                    window.CRIATURAS_3042 = {{ $r | jsonify | safeJS }};
                    window.LANG_PREFIX = "{{ "" | relLangURL }}";
                </script>
                {{ partial "searchbar.html" . }}
            </div>
        </nav>

        <button id="menu-toggle" class="md:hidden text-fox-red focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
        </button>
    </div>

    <!-- MENÚ MÓVIL -->
    <div id="mobile-menu" class="hidden md:hidden bg-ui-dark-gray border-t border-fox-red/30 py-2">
        <a href="{{ "/#creatures" | relLangURL }}" class="block px-4 py-2 hover:bg-fox-red/20">{{ T "criaturas" }}</a>
        <a href="{{ "/#gadgets" | relLangURL }}" class="block px-4 py-2 hover:bg-fox-red/20">{{ T "gadgets" }}</a>
        <a href="{{ "/#fanart" | relLangURL }}" class="block px-4 py-2 hover:bg-fox-red/20">{{ T "fanart" }}</a>
        <a href="{{ "/lore/" | relLangURL }}" class="block px-4 py-2 hover:bg-fox-red/20">{{ T "wiki" }}</a>
        <a href="{{ "/products/" | relLangURL }}" class="block px-4 py-2 bg-fox-red font-bold mt-2">{{ T "tienda"
            }}</a>

        <!--  CAMBIADOR DE IDIOMA MÓVIL -->
        <div class="flex justify-center space-x-8 py-4 border-t border-white/10 mt-2">
            {{ range .AllTranslations }}
            <a href="{{ .RelPermalink }}" class="flex flex-col items-center group">
                <span class="text-2xl mb-1">
                    {{ if eq .Language.Lang "es" }}{{ else }}{{ end }}
                </span>
                <span
                    class="uppercase text-xs font-bold transition {{ if eq .Language.Lang $.Lang }}text-fox-red{{ else }}text-bone-white/40{{ end }}">
                    {{ .Language.Lang }}
                </span>
            </a>
            {{ end }}
        </div>
    </div>
</header>